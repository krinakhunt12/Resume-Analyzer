<div class="results-container" *ngIf="!isLoading()">
    <!-- Header Section -->
    <div class="results-header">
      <button class="back-btn" (click)="goBack()" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="15,18 9,12 15,6"/>
        </svg>
        Back to Upload
      </button>
      <h1>Resume Analysis Results</h1>
      <div class="header-actions">
        <button class="download-btn" (click)="downloadReport()" [disabled]="generatingReport()">
          <svg *ngIf="!generatingReport()" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          <span *ngIf="!generatingReport()">Download Report</span>
          <span *ngIf="generatingReport()" class="download-spinner" aria-hidden="true"></span>
        </button>
      </div>
    </div>

  <!-- Score Summary Section -->
  <div class="score-summary-card">
    <div class="score-circle-container">
      <div class="score-circle-visual">
        <svg width="120" height="120" viewBox="0 0 120 120">
          <defs>
            <linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#60A5FA" />
              <stop offset="100%" stop-color="#2563eb" />
            </linearGradient>
          </defs>
          <g transform="translate(60,60)">
            <circle r="52" cx="0" cy="0" stroke="#e6edf7" stroke-width="12" fill="none"></circle>
            <circle r="52" cx="0" cy="0" stroke="url(#scoreGrad)" stroke-width="12" stroke-linecap="round" fill="none"
              [attr.stroke-dasharray]="getCircleDash(results()?.results?.overall_score || 0).circumference"
              [attr.stroke-dashoffset]="getCircleDash(results()?.results?.overall_score || 0).dashOffset"
              style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 600ms ease;"></circle>
            <foreignObject x="-40" y="-28" width="80" height="56">
              <div class="score-inner-visual" xmlns="http://www.w3.org/1999/xhtml">
                <div class="score-number">{{ results()?.results?.overall_score || 0 }}</div>
                <div class="score-label">ATS</div>
              </div>
            </foreignObject>
          </g>
        </svg>
      </div>
      <div class="score-status">
        <span class="status-badge" [style.background-color]="getScoreColor(results()?.results?.overall_score || 0)">
          {{ getScoreText(results()?.results?.overall_score || 0) }}
        </span>
        <p class="score-description">Your resume has been analyzed for ATS compatibility and content quality.</p>
      </div>
    </div>
  </div>

  <!-- Quick Stats Row -->
  <div class="quick-stats">
    <div class="stat-item">
      <div class="stat-value">{{ formatExperienceYears(results()?.results?.experience_years) }}</div>
      <div class="stat-label">Experience</div>
    </div>
    <div class="stat-item" *ngIf="hasJobDescription() && getMatchPercentage() !== null">
      <div class="stat-value">{{ getMatchPercentage() }}%</div>
      <div class="stat-label">Job Match</div>
    </div>
    <div class="stat-item" *ngIf="results()?.results?.ats_score">
      <div class="stat-value">{{ results()?.results?.ats_score }}/100</div>
      <div class="stat-label">ATS Score</div>
    </div>
    <div class="stat-item" *ngIf="results()?.results?.recommendations?.length">
      <div class="stat-value">{{ results()?.results?.recommendations?.length }}</div>
      <div class="stat-label">Suggestions</div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="content-grid" [class.fade-in]="hasResultsLoaded()">
    <!-- Recruiter Insights -->
    <div class="content-card insights-card" *ngIf="recruiterInsights()">
      <div class="card-header">
        <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/>
          <path d="M2 22c1.5-4 6-6 10-6s8.5 2 10 6"/>
        </svg>
        <h2>Recruiter Insights</h2>
      </div>
      <div class="card-content">
        <div class="insights-top">
          <div class="contact-info">
            <div class="contact-line"><strong>Name:</strong> {{ recruiterInsights()?.candidate_details?.name || results()?.parsed_resume?.contact_info?.name || 'N/A' }}</div>
            <div class="contact-line"><strong>Email:</strong> {{ getCandidateEmail() || 'Not found' }}</div>
            <div class="contact-line"><strong>Phone:</strong>
              <span [class.urgent]="!getCandidatePhone() || getCandidatePhone() === 'Not Found'">{{ getCandidatePhone() || 'Not Found' }}</span>
            </div>
            <div class="contact-line"><strong>Experience:</strong> {{ recruiterInsights()?.candidate_details?.total_years_experience || 'Not specified' }}</div>
          </div>
          <div class="insights-badges">
            <span class="badge score">Score: {{ recruiterInsights()?.ats_compatibility?.score || results()?.results?.overall_score || 0 }}</span>
            <span class="badge rating">{{ results()?.results?.rating || 'â€”' }}</span>
          </div>
        </div>

        <div class="insights-body">
          <div class="insights-section" *ngIf="recruiterInsights()?.resume_quality?.strengths?.length">
            <h4>Strengths</h4>
            <ul>
              <li *ngFor="let s of recruiterInsights()?.resume_quality?.strengths">{{ s }}</li>
            </ul>
          </div>

          <div class="insights-section" *ngIf="recruiterInsights()?.resume_quality?.weaknesses?.length">
            <h4>Weaknesses</h4>
            <ul>
              <li *ngFor="let w of recruiterInsights()?.resume_quality?.weaknesses" [class.urgent]="w.toLowerCase().includes('urgent')">{{ w }}</li>
            </ul>
          </div>

          <div class="insights-section" *ngIf="getImprovementSuggestions().length">
            <h4>Improvement Suggestions</h4>
            <ol>
              <li *ngFor="let sug of getImprovementSuggestions()">{{ sug }}</li>
            </ol>
          </div>
        </div>
      </div>
    </div>
    <!-- Resume Summary -->
    <div class="content-card">
      <div class="card-header">
        <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14,2 14,8 20,8"/>
        </svg>
        <h2>Resume Summary</h2>
      </div>
      <div class="card-content">
        <div *ngIf="results()?.results?.summary; else noSummary">
          <p class="summary-text">{{ results()?.results?.summary }}</p>
        </div>
        <ng-template #noSummary>
          <div class="empty-state">
            <p>Resume summary not available</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Key Strengths -->
    <div class="content-card" *ngIf="hasStrengths()">
        <div class="card-header">
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <h2>Key Strengths</h2>
        </div>
        <div class="card-content">
          <ul class="strengths-list">
            <li *ngFor="let strength of results()?.results?.strengths">
              <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="20,6 9,17 4,12"/>
              </svg>
              {{ strength }}
            </li>
          </ul>
        </div>
      </div>

    <!-- Skills Analysis -->
    <div class="content-card full-width" *ngIf="hasSkillsAnalysis()">
        <div class="card-header">
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <h2>Skills Analysis</h2>
        </div>
        <div class="card-content">
          <div class="skills-grid">
            <div class="skill-category" *ngIf="results()?.results?.skills_analysis?.technical_skills?.length">
              <h3>Technical Skills</h3>
              <div class="skill-tags">
                <span class="skill-tag tech" *ngFor="let skill of results()?.results?.skills_analysis?.technical_skills">{{ skill }}</span>
              </div>
            </div>

            <div class="skill-category" *ngIf="results()?.results?.skills_analysis?.soft_skills?.length">
              <h3>Soft Skills</h3>
              <div class="skill-tags">
                <span class="skill-tag soft" *ngFor="let skill of results()?.results?.skills_analysis?.soft_skills">{{ skill }}</span>
              </div>
            </div>

            <div class="skill-category" *ngIf="results()?.results?.skills_analysis?.missing_skills?.length">
              <h3>Skills to Consider Adding</h3>
              <div class="skill-tags">
                <span class="skill-tag missing" *ngFor="let skill of results()?.results?.skills_analysis?.missing_skills">{{ skill }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    <!-- Job Match Analysis -->
    <div class="content-card full-width" *ngIf="hasJobDescription() && hasKeywordMatch()">
      <div class="card-header">
        <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <h2>Job Match Analysis</h2>
        <div class="match-percentage" *ngIf="getMatchPercentage() !== null">
          <span class="percentage">{{ getMatchPercentage() }}% Match</span>
        </div>
      </div>
      <div class="card-content">
        <div class="keyword-analysis">
          <div class="keyword-section" *ngIf="results()?.results?.keyword_match?.matched_keywords?.length">
            <h4>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="20,6 9,17 4,12"/>
              </svg>
              Matched Keywords ({{ results()?.results?.keyword_match?.matched_keywords?.length }})
            </h4>
            <div class="keyword-tags matched">
              <span class="keyword-tag" *ngFor="let keyword of results()?.results?.keyword_match?.matched_keywords">{{ keyword }}</span>
            </div>
          </div>

          <div class="keyword-section" *ngIf="results()?.results?.keyword_match?.missing_keywords?.length">
            <h4>
              <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
              </svg>
              Missing Keywords ({{ results()?.results?.keyword_match?.missing_keywords?.length }})
            </h4>
            <div class="keyword-tags missing">
              <span class="keyword-tag" *ngFor="let keyword of results()?.results?.keyword_match?.missing_keywords">{{ keyword }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Improvement Recommendations -->
    <div class="content-card full-width" *ngIf="hasRecommendations()">
      <div class="card-header">
        <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <h2>Improvement Recommendations</h2>
      </div>
      <div class="card-content">
        <div class="recommendations-list">
          <div class="recommendation-item" *ngFor="let recommendation of results()?.results?.recommendations; let i = index">
            <div class="recommendation-number">{{ i + 1 }}</div>
            <div class="recommendation-content">
              <p>{{ recommendation }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="secondary-btn" (click)="goBack()">Upload Another Resume</button>
    <button class="primary-btn" (click)="startNewAnalysis()">Start New Analysis</button>
  </div>
</div>
<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading()">
  <div class="results-header" style="width:100%;">
    <div class="skeleton h-24" style="width:140px; margin-bottom:8px;"></div>
    <div class="skeleton h-24" style="width:220px;"></div>
  </div>

  <div class="score-summary-card" style="margin-top:1rem;">
    <div style="display:flex;gap:1.25rem;align-items:center;">
      <div class="skeleton" style="width:120px;height:120px;border-radius:999px;"></div>
      <div style="flex:1;">
        <div class="skeleton h-24" style="width:60%;margin-bottom:8px;"></div>
        <div class="skeleton h-16" style="width:40%;"></div>
      </div>
    </div>
  </div>

  <div class="content-grid" style="margin-top:1rem;">
    <div class="content-card" style="padding:1rem;">
      <div class="skeleton h-24" style="width:50%;margin-bottom:12px;"></div>
      <div class="skeleton h-16" style="width:100%;margin-bottom:6px;"></div>
      <div class="skeleton h-16" style="width:90%;margin-bottom:6px;"></div>
    </div>
    <div class="content-card" style="padding:1rem;">
      <div class="skeleton h-24" style="width:60%;margin-bottom:12px;"></div>
      <div class="skeleton h-16" style="width:100%;margin-bottom:6px;"></div>
      <div class="skeleton h-16" style="width:80%;margin-bottom:6px;"></div>
    </div>
    <div class="content-card full-width" style="padding:1rem;">
      <div class="skeleton h-24" style="width:40%;margin-bottom:12px;"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <div class="skeleton h-16" style="width:80px;"></div>
        <div class="skeleton h-16" style="width:120px;"></div>
        <div class="skeleton h-16" style="width:60px;"></div>
      </div>
    </div>
  </div>

  <div style="height:24px;"></div>
</div>